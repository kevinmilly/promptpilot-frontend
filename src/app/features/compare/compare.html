<!-- Top Input Card -->
<mat-card class="input-card glass-card">
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Enter your prompt</mat-label>
    <textarea matInput [(ngModel)]="prompt" rows="3" cols="10"
      placeholder="Ask something like 'Explain quantum computing simply'"></textarea>
  </mat-form-field>

  <div class="button-row">
    <button mat-flat-button color="primary" class="compare-button" (click)="onCompare()"
      [disabled]="loading || !prompt.trim()">
      <mat-icon *ngIf="!loading">bolt</mat-icon>
      <mat-progress-spinner *ngIf="loading" mode="indeterminate" diameter="20" color="accent"></mat-progress-spinner>
      <span *ngIf="!loading">Compare</span>
    </button>

    <!-- Optional: API Key button (disabled for now)
    <button
      mat-stroked-button
      color="accent"
      class="api-button"
      (click)="openApiKeyDialog()"
    >
      <mat-icon>vpn_key</mat-icon>
      Manage API Keys
    </button>
    -->
  </div>

  <mat-error *ngIf="error" class="error-message">
    {{ error }}
  </mat-error>
</mat-card>

<!-- Action Buttons (Copy / Save) -->
<div class="actions-row" *ngIf="results?.length">
  <button mat-stroked-button color="accent" (click)="copyAll()">
    <mat-icon>content_copy</mat-icon>
    Copy All Responses
  </button>

  <button mat-flat-button color="primary" (click)="saveComparison()">
    <mat-icon>save</mat-icon>
    Save Comparison
  </button>
</div>

<!-- Summary Card -->
<app-summary-card 
*ngIf="results?.length" 
[results]="results"
class="fade-in"
></app-summary-card>

<!-- Explain Metrics Section -->
<div *ngIf="results?.length" class="metrics-explainer-container">
  <div class="metrics-header">
    <h3>📘 Understanding Your Metrics</h3>
    <button mat-stroked-button color="accent" (click)="showInfo = !showInfo">
      <mat-icon>{{ showInfo ? 'expand_less' : 'info_outline' }}</mat-icon>
      {{ showInfo ? 'Hide Info' : 'Explain Metrics' }}
    </button>
  </div>


  <div *ngIf="showInfo" class="metrics-info glass-panel">
    <p matTooltip="How long each model took to respond (lower is faster)">
      ⚡ <b>Latency:</b> Response time in milliseconds
    </p>
    <p matTooltip="Approximate token count used to generate each response">
      💬 <b>Tokens:</b> Token usage estimate
    </p>
    <p matTooltip="Based on token rates for each model">
      💰 <b>Cost:</b> Estimated price for response generation
    </p>
    <p matTooltip="How easy the response is to read and understand">
      🧠 <b>Readability:</b> Simplicity and clarity of writing
    </p>
    <p matTooltip="Detected emotional tone (formal, neutral, playful, etc.)">
      🎭 <b>Tone:</b> Style and personality of the text
    </p>
    <p matTooltip="How logically consistent the response is compared to others">
      🔗 <b>Coherence:</b> Logical flow and alignment across responses
    </p>
  </div>
</div>

<!-- View Mode Toggle -->
<div *ngIf="results?.length" class="view-toggle">
  <mat-button-toggle-group [(ngModel)]="viewMode" aria-label="View mode">
    <mat-button-toggle value="full">🧩 Full View</mat-button-toggle>
    <mat-button-toggle value="compact">📊 Compact View</mat-button-toggle>
  </mat-button-toggle-group>
</div>

<!-- ================================
     RESULTS GRID
================================ -->
<section class="results-grid fade-in" *ngIf="results?.length">
  <app-model-card
    *ngFor="let result of results"
    [result]="result"
    [viewMode]="viewMode"
    class="result-card"
  ></app-model-card>
</section>


<!-- ================================
     LOADING PLACEHOLDER
================================ -->
<section *ngIf="loading" class="loading-section fade-in">
  <div class="loading-layout">
    <div class="loading-console">
      <pre>
<ng-container *ngIf="loadingStep >= 1">⏳ Connecting to models...</ng-container>
<ng-container *ngIf="loadingStep >= 2">⚙️ Querying Gemini...</ng-container>
<ng-container *ngIf="loadingStep >= 3">⚙️ Querying ChatGPT...</ng-container>
<ng-container *ngIf="loadingStep >= 4">⚙️ Querying Claude...</ng-container>
<ng-container *ngIf="loadingStep >= 5">💡 Collecting insights...</ng-container>
<ng-container *ngIf="loadingStep >= 6">✅ Preparing comparison results...</ng-container>
      </pre>
    </div>

    <div class="skeleton-grid">
      <div class="skeleton-card" *ngFor="let i of [1, 2, 3]">
        <div class="skeleton-header"></div>
        <div class="skeleton-line short"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line long"></div>
      </div>
    </div>
  </div>
</section>



<!-- Saved Comparisons -->
<div class="saved-comparisons" *ngIf="savedComparisons.length">
  <h3>📂 Saved Comparisons</h3>
  <ul>
    <li *ngFor="let item of savedComparisons" (click)="loadComparison(item)">
      <strong>{{ item.prompt | slice: 0:60 }}</strong>
      <small>{{ item.timestamp | date: 'short' }}</small>
      <button mat-icon-button color="warn" (click)="deleteComparison(item, $event)">
        <mat-icon>delete</mat-icon>
      </button>
    </li>
  </ul>

  <button mat-flat-button color="warn" (click)="clearAllComparisons()">
    Clear All
  </button>
</div>

<!-- Empty State -->
<div class="empty-state" *ngIf="!loading && !results?.length && !error">
  <p>🧠 Enter a prompt and click Compare to see how models respond.</p>
</div>