<!-- Top Input Card -->
<mat-card class="input-card glass-card">
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Enter your prompt</mat-label>
    <textarea
      matInput
      [(ngModel)]="prompt"
      rows="3"
      placeholder="Ask something like 'Explain quantum computing simply'"
    ></textarea>
  </mat-form-field>

  <div class="button-row">
    <button
      mat-flat-button
      color="primary"
      class="compare-button"
      (click)="onCompare()"
      [disabled]="loading || !prompt.trim()"
    >
      <mat-icon *ngIf="!loading">bolt</mat-icon>
      <mat-progress-spinner
        *ngIf="loading"
        mode="indeterminate"
        diameter="20"
        color="accent"
      ></mat-progress-spinner>
      <span *ngIf="!loading">Compare</span>
    </button>

    <!-- Optional: API Key button (disabled for now)
    <button
      mat-stroked-button
      color="accent"
      class="api-button"
      (click)="openApiKeyDialog()"
    >
      <mat-icon>vpn_key</mat-icon>
      Manage API Keys
    </button>
    -->
  </div>

  <mat-error *ngIf="error" class="error-message">
    {{ error }}
  </mat-error>
</mat-card>

<!-- Action Buttons (Copy / Save) -->
<div class="actions-row" *ngIf="results?.length">
  <button mat-stroked-button color="accent" (click)="copyAll()">
    <mat-icon>content_copy</mat-icon>
    Copy All Responses
  </button>

  <button mat-flat-button color="primary" (click)="saveComparison()">
    <mat-icon>save</mat-icon>
    Save Comparison
  </button>
</div>

<!-- Summary Card -->
<app-summary-card *ngIf="results?.length" [results]="results"></app-summary-card>

<!-- Explain Metrics Section -->
<div *ngIf="results?.length" class="metrics-explainer-container">
  <div class="metrics-header">
    <h3>ğŸ“˜ Understanding Your Metrics</h3>
    <button mat-stroked-button color="accent" (click)="showInfo = !showInfo">
      <mat-icon>{{ showInfo ? 'expand_less' : 'info_outline' }}</mat-icon>
      {{ showInfo ? 'Hide Info' : 'Explain Metrics' }}
    </button>
  </div>

  <div *ngIf="showInfo" class="metrics-info glass-panel">
    <p><b>âš¡ Latency:</b> How long the model took to respond (in milliseconds). Lower is faster.</p>
    <p><b>ğŸ’¬ Tokens:</b> The approximate number of tokens used. More tokens = longer or more complex responses.</p>
    <p><b>ğŸ’° Cost:</b> The estimated price for generating the response, based on tokens and each modelâ€™s rate.</p>
    <p><b>ğŸ§  Readability:</b> Measures how easy the text is to read â€” higher scores mean simpler, clearer writing.</p>
    <p><b>ğŸ­ Tone:</b> The overall emotional or stylistic tone detected (e.g., neutral, positive, formal).</p>
    <p><b>ğŸ”— Coherence:</b> How logically connected and consistent the response is compared to other models.</p>
  </div>
</div>

<!-- Results Grid -->
<section class="results-grid" *ngIf="results?.length">
  <app-model-card
    *ngFor="let result of results"
    [result]="result"
    class="result-card"
  ></app-model-card>
</section>

<!-- ğŸ”¥ Animated console + skeleton loader -->
<section *ngIf="loading" class="loading-section">
  <div class="loading-console">
    <pre>
      <ng-container *ngIf="loadingStep >= 1">â³ Connecting to models...</ng-container>
      <ng-container *ngIf="loadingStep >= 2">âš™ï¸ Querying Gemini...</ng-container>
      <ng-container *ngIf="loadingStep >= 3">âš™ï¸ Querying Chat GPT...</ng-container>
      <ng-container *ngIf="loadingStep >= 4">âš™ï¸ Querying Claude...</ng-container>
      <ng-container *ngIf="loadingStep >= 5">ğŸ’¡ Collecting insights...</ng-container>
      <ng-container *ngIf="loadingStep >= 6">âœ… Preparing comparison results...</ng-container>
    </pre>
  </div>

  <div class="skeleton-grid">
    <div class="skeleton-card" *ngFor="let i of [1,2,3]">
      <div class="skeleton-header"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line long"></div>
    </div>
  </div>
</section>


<!-- Saved Comparisons -->
<div class="saved-comparisons" *ngIf="savedComparisons.length">
  <h3>ğŸ“‚ Saved Comparisons</h3>
  <ul>
    <li *ngFor="let item of savedComparisons" (click)="loadComparison(item)">
      <strong>{{ item.prompt | slice: 0:60 }}</strong>
      <small>{{ item.timestamp | date: 'short' }}</small>
      <button
        mat-icon-button
        color="warn"
        (click)="deleteComparison(item, $event)"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </li>
  </ul>

  <button mat-flat-button color="warn" (click)="clearAllComparisons()">
    Clear All
  </button>
</div>

<!-- Empty State -->
<div class="empty-state" *ngIf="!loading && !results?.length && !error">
  <p>ğŸ§  Enter a prompt and click Compare to see how models respond.</p>
</div>
